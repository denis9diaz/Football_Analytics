---
import Layout from "../layouts/Layout.astro";
import "../styles/global.css";
import "animate.css";

const uid = Astro.url.searchParams.get("uid");
const token = Astro.url.searchParams.get("token");
---

<Layout>
  <section
    class="max-w-xl mx-auto px-6 py-20 text-center animate__animated animate__fadeIn"
  >
    <div
      id="activation-box"
      class="bg-white rounded-2xl shadow-lg p-8 border border-blue-100 hidden"
    >
      <h1 class="text-2xl font-bold text-blue-600 mb-4">¡Cuenta activada!</h1>
      <p class="text-gray-700 mb-6">
        Tu cuenta ha sido verificada correctamente. Ya puedes iniciar sesión.
      </p>
      <a
        href="/login"
        class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded transition"
      >
        Iniciar sesión
      </a>
    </div>

    <div
      id="error-box"
      class="bg-white rounded-2xl shadow-lg p-8 border border-red-200 hidden"
    >
      <h1 class="text-2xl font-bold text-red-600 mb-4">Error</h1>
      <p class="text-gray-700 mb-6">
        El enlace de activación no es válido o ha expirado.
      </p>
      <a
        href="/registro"
        class="inline-block bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-2 rounded transition"
      >
        Volver al registro
      </a>
    </div>
  </section>

  <script is:inline>
    const params = new URLSearchParams(window.location.search);
    const uid = params.get("uid");
    const token = params.get("token");
    const API_URL = import.meta.env.PUBLIC_API_URL;

    if (uid && token) {
      fetch(`${API_URL}/api/auth/activate/?uid=${uid}&token=${token}`)
        .then((res) =>
          res.json().then((data) => ({ status: res.status, body: data }))
        )
        .then(({ status }) => {
          if (status === 200) {
            document
              .getElementById("activation-box")
              .classList.remove("hidden");
          } else {
            document.getElementById("error-box").classList.remove("hidden");
          }
        })
        .catch(() => {
          document.getElementById("error-box").classList.remove("hidden");
        });
    } else {
      document.getElementById("error-box").classList.remove("hidden");
    }
  </script>
</Layout>
